<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Welcome to day 1! | Non-Linear Models for the Plant Sciences</title>
  <meta name="description" content="<p>An applied introduction to nonlinear models for the plant sciences, with
emphasis on interpretation, uncertainty, and conscient implementation in R.</p>" />
  <meta name="generator" content="bookdown 0.46 and GitBook 2.6.7" />

  <meta property="og:title" content="Welcome to day 1! | Non-Linear Models for the Plant Sciences" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>An applied introduction to nonlinear models for the plant sciences, with
emphasis on interpretation, uncertainty, and conscient implementation in R.</p>" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Welcome to day 1! | Non-Linear Models for the Plant Sciences" />
  
  <meta name="twitter:description" content="<p>An applied introduction to nonlinear models for the plant sciences, with
emphasis on interpretation, uncertainty, and conscient implementation in R.</p>" />
  

<meta name="author" content="Claudio Dias da Silva Jr &amp; Trevor Hefley" />


<meta name="date" content="2026-02-04" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="pre-workshop-guide.html"/>
<link rel="next" href="welcome-to-day-2.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/codefolding-lua-1.1/codefolding-lua.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />


<style type="text/css">
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Nonlinear Models for the Plant Sciences</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>About</a></li>
<li class="chapter" data-level="" data-path="pre-workshop-guide.html"><a href="pre-workshop-guide.html"><i class="fa fa-check"></i>Pre-workshop guide</a>
<ul>
<li class="chapter" data-level="" data-path="pre-workshop-guide.html"><a href="pre-workshop-guide.html#how-to-make-the-most-of-this-workshop"><i class="fa fa-check"></i>How to make the most of this workshop</a></li>
<li class="chapter" data-level="" data-path="pre-workshop-guide.html"><a href="pre-workshop-guide.html#what-will-we-learn"><i class="fa fa-check"></i>What will we learn?</a></li>
<li class="chapter" data-level="" data-path="pre-workshop-guide.html"><a href="pre-workshop-guide.html#notation-guide"><i class="fa fa-check"></i>Notation guide</a></li>
<li class="chapter" data-level="" data-path="pre-workshop-guide.html"><a href="pre-workshop-guide.html#glossary"><i class="fa fa-check"></i>Glossary</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html"><i class="fa fa-check"></i>Welcome to day 1!</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#linear-models-and-parameter-estimation"><i class="fa fa-check"></i>Linear models and parameter estimation</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#section-1-what-is-and-what-isnt-a-linear-model"><i class="fa fa-check"></i>Section 1: What is and what isn’t a linear model</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#section-2-estimation-and-inference-a-linear-model-example"><i class="fa fa-check"></i>Section 2: Estimation and Inference: A linear model example</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#i.-loss-function-approach"><i class="fa fa-check"></i>I. Loss function approach</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#ii.-likelihood-based-approach"><i class="fa fa-check"></i>II. Likelihood-based approach</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#iii.-bayesian-approach"><i class="fa fa-check"></i>III. Bayesian approach</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-1.html"><a href="welcome-to-day-1.html#questions"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html"><i class="fa fa-check"></i>Welcome to Day 2!!</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html#nonlinear-models"><i class="fa fa-check"></i>Nonlinear models</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html#section-3-exercises-from-day-1"><i class="fa fa-check"></i>Section 3: Exercises from day 1</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html#section-4-working-with-weakly-identifiable-parameters"><i class="fa fa-check"></i>Section 4: Working with weakly identifiable parameters</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html#extra-summary"><i class="fa fa-check"></i>Extra: Summary</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-2.html"><a href="welcome-to-day-2.html#questions-1"><i class="fa fa-check"></i>Questions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="welcome-to-day-3.html"><a href="welcome-to-day-3.html"><i class="fa fa-check"></i>Welcome to day 3!!!</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-3.html"><a href="welcome-to-day-3.html#bayesian-nonlinear-models"><i class="fa fa-check"></i>Bayesian Nonlinear models</a>
<ul>
<li class="chapter" data-level="" data-path="welcome-to-day-3.html"><a href="welcome-to-day-3.html#section-5-exercises-from-day-2"><i class="fa fa-check"></i>Section 5: Exercises from day 2</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-3.html"><a href="welcome-to-day-3.html#section-6-bayesian-nonlinear-models"><i class="fa fa-check"></i>Section 6: Bayesian nonlinear models</a></li>
<li class="chapter" data-level="" data-path="welcome-to-day-3.html"><a href="welcome-to-day-3.html#wrap-up"><i class="fa fa-check"></i>Wrap-up</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/ClaudioDSJr11/Non-Linear-Models-for-the-Plant-Sciences" target="_blank">View source on GitHub</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Non-Linear Models for the Plant Sciences</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="welcome-to-day-1" class="section level1 hasAnchor">
<h1>Welcome to day 1!<a href="welcome-to-day-1.html#welcome-to-day-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<ul>
<li><p>In this workshop material, theory and R codes are mixed. Throughout the workshop, our main focus will be on understanding the <em>why</em>. We want to demonstrate that all codes in this workshop are used after deep understanding of what is going on behind them, after we thought about our models in depth.</p></li>
<li><p>We will have the following structure:</p>
<ul>
<li><p>Day 1: Linear models and parameter estimation</p></li>
<li><p>Day 2: Nonlinear models</p></li>
<li><p>Day 3: Bayesian nonlinear models</p></li>
</ul></li>
<li><p>More importantly, <strong>don’t panic!</strong> We will be learning together, slowly. We do not expect you to come into the workshop (or leave it) knowing everything.</p></li>
<li><p>Our goal is to provide an immersion into the topic and some initial guidance, so you can move forward with your own projects and continued learning.</p></li>
<li><p>Please feel free to stop me and ask questions at any time. I will answer it to the best of my knowledge, and if I don’t know the answer, either Trevor will jump in or I will make sure to come back to you with a clear explanation in a later moment.</p></li>
</ul>
<p><br><br></p>
<div id="linear-models-and-parameter-estimation" class="section level2 hasAnchor">
<h2>Linear models and parameter estimation<a href="welcome-to-day-1.html#linear-models-and-parameter-estimation" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div>
<p><strong>Outline:</strong></p>
<p>Section 1: What is and what isn’t a linear model</p>
<p>Section 2: Estimation and Inference: A linear model example using:</p>
<ul>
<li><p>Loss function approach</p></li>
<li><p>Likelihood-based approach</p></li>
<li><p>Bayesian approach</p></li>
</ul>
<p>Why Bayesian may be useful?</p>
<p>Questions</p>
<ul>
<li>Recommended - Base for Day 2</li>
</ul>
<p>Optional - For practice only!</p>
<p><br><br></p>
<p><strong>What we expect you to learn on Day 1:</strong></p>
<ul>
<li><p>What is a linear model and what is not</p></li>
<li><p>There are different types of estimation, and they have different assumptions</p></li>
<li><p>When it is wroth it to work with more assumption heavy approaches</p></li>
</ul>
</div>
<p><br><br></p>
<div id="section-1-what-is-and-what-isnt-a-linear-model" class="section level3 hasAnchor">
<h3>Section 1: What is and what isn’t a linear model<a href="welcome-to-day-1.html#section-1-what-is-and-what-isnt-a-linear-model" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="recap-on-linear-models" class="section level4 hasAnchor">
<h4>Recap on linear models<a href="welcome-to-day-1.html#recap-on-linear-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall the famous intercept-and-slope model, written in the “model equation form”<a href="#fn1" class="footnote-ref" id="fnref1"><sup>1</sup></a>:</p>
<p><span class="math display">\[
y_i = \beta_0 + x_i\beta_1 + \varepsilon_i
\]</span></p>
<p>Here we have the observed value of the <span class="math inline">\(i\)</span>th observation (<span class="math inline">\(y_i\)</span>), the intercept (<span class="math inline">\(\beta_0\)</span>), representing the level of <span class="math inline">\(y\)</span> when <span class="math inline">\(x\)</span> = 0, the slope (<span class="math inline">\(\beta_1\)</span>), which for a continuous <span class="math inline">\(x_i\)</span>, it represents the change in <span class="math inline">\(y\)</span> given a one unit change in <span class="math inline">\(x\)</span>, and the residual (<span class="math inline">\(\varepsilon_i\)</span>) that represents the different between the observation and the model line for each point.</p>
<p><img src="_main_files/figure-html/unnamed-chunk-2-1.png" alt="" width="672" /></p>
</div>
<div id="what-makes-a-model-linear" class="section level4 hasAnchor">
<h4>What makes a model linear?<a href="welcome-to-day-1.html#what-makes-a-model-linear" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<center>
<strong>A model is linear if it is linear in its parameters.</strong>
</center>
<p>Other examples of linear models are:</p>
<p><strong>Polynomial regression:</strong></p>
<p>Extend the linear regression in a way that the relationship between the predictors and the response is nonlinear. A polynomial function is a special case of base function<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_i+\beta_2x_i^2+\varepsilon_i
\]</span></p>
<p><img src="_main_files/figure-html/unnamed-chunk-3-1.png" alt="" width="672" /></p>
<p><strong>Regression splines:</strong></p>
<p>In this type of model, <span class="math inline">\(x\)</span> is partitioned by <span class="math inline">\(K\)</span> points and within each space between these points, a polynomial model is fitted. Splines are a special case of piecewise degree-d polynomial, in which a constraint ensures that it is continuous. This means that at each “knot” (<span class="math inline">\(K\)</span>), that define a breaks in <span class="math inline">\(x\)</span>, the line remains continuous. Simple piecewise polynomial regression exist, but they do not ensure this continuity.</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1b_1(x_i) + \beta_2b_{K + 2}(x_i) + \varepsilon_i
\]</span></p>
<p><img src="_main_files/figure-html/unnamed-chunk-4-1.png" alt="" width="672" /></p>
<center>
<p>Shape <span class="math inline">\(\neq\)</span> Linearity</p>
<p>Linear models <span class="math inline">\(\neq\)</span> Simplicity</p>
</center>
<p><strong>Simple rule: A model is linear if:</strong></p>
<ul>
<li><p><strong>All unknown parameter only multiplies known quantities</strong></p></li>
<li><p><strong>All parameters are added together</strong></p></li>
<li><p><strong>All parameters are outside nonlinear functions.</strong></p></li>
</ul>
<p><span class="math display">\[
\mathbf{\hat{y}} = \sum_i\beta_ib_i(\mathbf{x})
\]</span></p>
</div>
<div id="what-about-nonlinear-models" class="section level4 hasAnchor">
<h4>What about nonlinear models?<a href="welcome-to-day-1.html#what-about-nonlinear-models" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In simple terms, in nonlinear models, parameters are inside nonlinear functions.</p>
<p>Example:</p>
<center>
<strong>Exponential model:</strong>
</center>
<p><span class="math display">\[
y_i = \beta_0*e^{\beta_1x_i} + \varepsilon_i
\]</span></p>
<p><img src="_main_files/figure-html/unnamed-chunk-5-1.png" alt="" width="672" /></p>
<p>Checklist:</p>
<ul>
<li><p>All unknown parameters only multiply known quantities? X -&gt; <span class="math inline">\(\beta_0*e^{\beta_1x_i}\)</span></p></li>
<li><p>All parameters are added together? X -&gt; <span class="math inline">\(\beta_0*e^{\beta_1x_i}\)</span></p></li>
<li><p>All parameters are outside nonlinear functions? X -&gt; <span class="math inline">\(e^{\beta_1x_i}\)</span></p></li>
</ul>
<p>How do we work with nonlinear models?</p>
<ul>
<li><p>Fit it as it is.</p></li>
<li><p>Linearization.</p>
<ul>
<li>More about both on day 2!</li>
</ul></li>
</ul>
<p><br><br></p>
</div>
<div id="how-do-we-chose-a-a-model" class="section level4 hasAnchor">
<h4>How do we chose a a model?<a href="welcome-to-day-1.html#how-do-we-chose-a-a-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>What is your research question?</p>
<ul>
<li>Pattern (phenomenological) vs Process (mechanistic)</li>
</ul></li>
<li><p>What do you know about what you are investigating?</p></li>
<li><p>What do you want from the model?</p>
<ul>
<li>Focus: Inference? Prediction? Both?</li>
</ul></li>
</ul>
<p><br><br></p>
<div class="important">
<p><strong>Highlight from Section 1:</strong></p>
<center>
<p>Shape <span class="math inline">\(\neq\)</span> Linearity: Not being a line does not mean it is not linear!</p>
<p>Linear models <span class="math inline">\(\neq\)</span> Simplicity: Linear models can be quite complex (e.g. Splines).</p>
<p>Model selection is more of a philosophical question, but some points might help you on the decision.</p>
</center>
</div>
<p><br><br></p>
</div>
</div>
<div id="section-2-estimation-and-inference-a-linear-model-example" class="section level3 hasAnchor">
<h3>Section 2: Estimation and Inference: A linear model example<a href="welcome-to-day-1.html#section-2-estimation-and-inference-a-linear-model-example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Estimation: The process of obtaining numerical values for the unknown quantities (parameters) of a model from observed data.</p>
<p>Inference: Interpreting these estimated parameters in the context of the population or data-generating process (model). Inference is made on <strong>non-observable quantities</strong> of interest, like the parameters (e.g. <span class="math inline">\(\beta_1\)</span>) and involves quantifying <strong>uncertainty</strong> and <strong>drawing conclusions beyond the observed sample</strong>.</p>
<p><br><br></p>
<div id="example-understanding-nitrogen-balance-in-grain-legumes" class="section level4 hasAnchor">
<h4>Example: Understanding nitrogen balance in grain legumes<a href="welcome-to-day-1.html#example-understanding-nitrogen-balance-in-grain-legumes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Details from <a href="https://link.springer.com/article/10.1186/s13007-024-01261-9">Palmero et al. 2024</a></p>
<p>A simple intercept-slope linear model:</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_i + \varepsilon_i
\]</span></p>
<p>in which:</p>
<ul>
<li><p><span class="math inline">\(y_i\)</span> represents the proportion (%) of nitrogen (N) derived from the atmosphere (Ndfa)</p></li>
<li><p><span class="math inline">\(x_i\)</span> represents the partial N balance (fixed N - removed N by grains) in kg/ha</p></li>
</ul>
<p>The research question: Which Ndfa (<span class="math inline">\(y_i\)</span>) leads to a neutral N balance (<span class="math inline">\(x_i = 0\)</span>)?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="welcome-to-day-1.html#cb1-1" tabindex="-1"></a><span class="co"># Data preparation</span></span>
<span id="cb1-2"><a href="welcome-to-day-1.html#cb1-2" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;Palmero_data.csv&quot;</span>)</span>
<span id="cb1-3"><a href="welcome-to-day-1.html#cb1-3" tabindex="-1"></a>df_a <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span>Scenario <span class="sc">==</span> <span class="st">&quot;Scenario A&quot;</span>),]</span>
<span id="cb1-4"><a href="welcome-to-day-1.html#cb1-4" tabindex="-1"></a><span class="fu">plot</span>(df_a<span class="sc">$</span>Ndfa, df_a<span class="sc">$</span>PartNbalance, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>)</span>
<span id="cb1-5"><a href="welcome-to-day-1.html#cb1-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-6-1.png" alt="" width="672" /></p>
</div>
</div>
<div id="i.-loss-function-approach" class="section level3 hasAnchor">
<h3>I. Loss function approach<a href="welcome-to-day-1.html#i.-loss-function-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>How does it works?</strong></p>
<p><img src="_main_files/figure-html/unnamed-chunk-7-1.png" alt="" width="672" /></p>
<p>Loss function: How we calculate the distance between observed and predicted by the model.</p>
<ul>
<li>Several different options, the most famous: Least Square - <span class="math inline">\(\sum_{i = 1}^n(y_i - \beta_0 - \beta_1x_i)^2\)</span>
<ul>
<li>Least Square characteristics: Small residuals = Small loss / Large residuals = Large loss</li>
</ul></li>
</ul>
<p>This approach produces a line of best fit based on values for <span class="math inline">\(\beta_0\)</span> and <span class="math inline">\(\beta_1\)</span> that minimizes the distance.</p>
<center>
<p>At this point: <strong>No uncertainty around estimation, no p-values, no inference, only parameter values!</strong></p>
<p>A loss function by itself gives no inference. Inference comes from assumptions on the residuals (<span class="math inline">\(\varepsilon_i\)</span>)</p>
<p><strong>Here:</strong> <span class="math inline">\(\varepsilon_i = y_i - \hat{y}_i\)</span></p>
</center>
<p><br><br></p>
<p><strong>For our example:</strong></p>
<p>Fit a simple intercept-slope linear model to data using least squares and calculate the value of Ndfa that is needed to achieve a neutral N balance (<span class="math inline">\(\theta\)</span>).</p>
<p><span class="math display">\[
y_i = \beta_0 + \beta_1x_i + \varepsilon_i
\]</span></p>
<p>Theta is a derived quantity<a href="#fn3" class="footnote-ref" id="fnref3"><sup>3</sup></a> calculated as:</p>
<p><span class="math display">\[
Ndfa = -\frac{\beta_0}{\beta_1}
\]</span></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="welcome-to-day-1.html#cb2-1" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb2-2"><a href="welcome-to-day-1.html#cb2-2" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(PartNbalance <span class="sc">~</span> Ndfa, <span class="at">data =</span> df_a)</span>
<span id="cb2-3"><a href="welcome-to-day-1.html#cb2-3" tabindex="-1"></a></span>
<span id="cb2-4"><a href="welcome-to-day-1.html#cb2-4" tabindex="-1"></a><span class="co"># Ndfa to achieve neutral N balance</span></span>
<span id="cb2-5"><a href="welcome-to-day-1.html#cb2-5" tabindex="-1"></a>b0hat_loss <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m1)[<span class="dv">1</span>]) <span class="co"># extract the intercept</span></span>
<span id="cb2-6"><a href="welcome-to-day-1.html#cb2-6" tabindex="-1"></a>b1hat_loss <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m1)[<span class="dv">2</span>]) <span class="co"># extract the slope</span></span>
<span id="cb2-7"><a href="welcome-to-day-1.html#cb2-7" tabindex="-1"></a></span>
<span id="cb2-8"><a href="welcome-to-day-1.html#cb2-8" tabindex="-1"></a>thetahat_loss <span class="ot">&lt;-</span> <span class="sc">-</span>b0hat_loss<span class="sc">/</span>b1hat_loss <span class="co"># calculate theta</span></span>
<span id="cb2-9"><a href="welcome-to-day-1.html#cb2-9" tabindex="-1"></a></span>
<span id="cb2-10"><a href="welcome-to-day-1.html#cb2-10" tabindex="-1"></a>thetahat_loss</span></code></pre></div>
</details>
<pre><code>## [1] 58.26843</code></pre>
<p>Visual representation of our line of best fit and <span class="math inline">\(\theta\)</span>:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="welcome-to-day-1.html#cb4-1" tabindex="-1"></a><span class="fu">plot</span>(df_a<span class="sc">$</span>Ndfa, df_a<span class="sc">$</span>PartNbalance, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>)</span>
<span id="cb4-2"><a href="welcome-to-day-1.html#cb4-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb4-3"><a href="welcome-to-day-1.html#cb4-3" tabindex="-1"></a><span class="fu">abline</span>(m1, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb4-4"><a href="welcome-to-day-1.html#cb4-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> thetahat_loss, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-9-1.png" alt="" width="672" /></p>
<p><br><br></p>
</div>
<div id="ii.-likelihood-based-approach" class="section level3 hasAnchor">
<h3>II. Likelihood-based approach<a href="welcome-to-day-1.html#ii.-likelihood-based-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>How does it work?</strong></p>
<p>Instead of minimizing the distance, we now maximize the likelihood function.</p>
<p>What likelihood do?</p>
<ul>
<li><p>According to the data-generating process (model + assumption) and data, estimate values of the parameters that are more plausible.</p></li>
<li><p>No more a line of best fit, but an expectation/mean.</p></li>
</ul>
<p>To define a likelihood, we make a <strong>distributional assumption</strong> for the random error term. The most common:</p>
<p><span class="math display">\[
\varepsilon_i \sim N(0, \sigma^2)
\]</span></p>
<ul>
<li>This distributional assumption is about how the data is generated, it means we believe the deviations between the observed data and the model predictions arise from a normal distribution with mean 0 and variance <span class="math inline">\(\sigma^2\)</span>.</li>
</ul>
<p><img src="_main_files/figure-html/unnamed-chunk-10-1.png" alt="" width="672" /></p>
<center>
<strong>Here we have full likelihood based statistical inference (p-values, confidence intervals, etc).</strong>
</center>
<p><br><br></p>
<p><strong>For our example:</strong></p>
<p>Fit a simple intercept-slope linear model to data using least squares and calculate the value of Ndfa that is needed to achieve a neutral N balance (<span class="math inline">\(\theta\)</span>).</p>
<p><span class="math display">\[ y_i = \beta_0 + \beta_1x_i + \varepsilon_i \\ \varepsilon_i \sim N(0, \sigma^2) \]</span></p>
<p>or</p>
<p><span class="math display">\[
y_i \sim N(\beta_0 + \beta_1x_i, \sigma^2)
\]</span></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="welcome-to-day-1.html#cb5-1" tabindex="-1"></a><span class="fu">library</span>(nlme)</span>
<span id="cb5-2"><a href="welcome-to-day-1.html#cb5-2" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb5-3"><a href="welcome-to-day-1.html#cb5-3" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">gls</span>(PartNbalance <span class="sc">~</span> Ndfa, <span class="at">data =</span> df_a, <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb5-4"><a href="welcome-to-day-1.html#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="welcome-to-day-1.html#cb5-5" tabindex="-1"></a><span class="co"># Ndfa to achieve neutral N balance</span></span>
<span id="cb5-6"><a href="welcome-to-day-1.html#cb5-6" tabindex="-1"></a>b0hat_ml <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m2)[<span class="dv">1</span>]) <span class="co"># extract the intercept</span></span>
<span id="cb5-7"><a href="welcome-to-day-1.html#cb5-7" tabindex="-1"></a>b1hat_ml <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m2)[<span class="dv">2</span>]) <span class="co"># extract the slope</span></span>
<span id="cb5-8"><a href="welcome-to-day-1.html#cb5-8" tabindex="-1"></a></span>
<span id="cb5-9"><a href="welcome-to-day-1.html#cb5-9" tabindex="-1"></a>thetahat_ml <span class="ot">&lt;-</span> <span class="sc">-</span>b0hat_ml<span class="sc">/</span>b1hat_ml <span class="co"># calculate theta</span></span>
<span id="cb5-10"><a href="welcome-to-day-1.html#cb5-10" tabindex="-1"></a></span>
<span id="cb5-11"><a href="welcome-to-day-1.html#cb5-11" tabindex="-1"></a>thetahat_ml</span></code></pre></div>
</details>
<pre><code>## [1] 58.26843</code></pre>
<p>Here we can construct confidence intervals by approximating the standard errors using delta method<a href="#fn4" class="footnote-ref" id="fnref4"><sup>4</sup></a>.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="welcome-to-day-1.html#cb7-1" tabindex="-1"></a><span class="fu">library</span>(msm)</span>
<span id="cb7-2"><a href="welcome-to-day-1.html#cb7-2" tabindex="-1"></a>theta_se <span class="ot">&lt;-</span> <span class="fu">deltamethod</span>(<span class="sc">~-</span>x1<span class="sc">/</span>x2, <span class="at">mean =</span> <span class="fu">coef</span>(m2), <span class="at">cov =</span> <span class="fu">vcov</span>(m2))</span>
<span id="cb7-3"><a href="welcome-to-day-1.html#cb7-3" tabindex="-1"></a>theta_ci <span class="ot">&lt;-</span> <span class="fu">c</span>(thetahat_ml<span class="fl">-1.96</span><span class="sc">*</span>theta_se, thetahat_ml<span class="fl">+1.96</span><span class="sc">*</span>theta_se)</span>
<span id="cb7-4"><a href="welcome-to-day-1.html#cb7-4" tabindex="-1"></a>theta_ci</span></code></pre></div>
</details>
<pre><code>## [1] 52.88317 63.65370</code></pre>
<p>Visual representation of our expected values and <span class="math inline">\(\hat{\theta}\)</span>:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="welcome-to-day-1.html#cb9-1" tabindex="-1"></a><span class="fu">plot</span>(df_a<span class="sc">$</span>Ndfa, df_a<span class="sc">$</span>PartNbalance, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>)</span>
<span id="cb9-2"><a href="welcome-to-day-1.html#cb9-2" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb9-3"><a href="welcome-to-day-1.html#cb9-3" tabindex="-1"></a><span class="fu">abline</span>(m2, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb9-4"><a href="welcome-to-day-1.html#cb9-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> thetahat_ml, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb9-5"><a href="welcome-to-day-1.html#cb9-5" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_ci[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb9-6"><a href="welcome-to-day-1.html#cb9-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_ci[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-13-1.png" alt="" width="672" /></p>
<p>What changes from the loss function approach?</p>
<ul>
<li><p>More complexity;</p></li>
<li><p>Uncertainty estimation (around estimated <span class="math inline">\(\hat{\theta}\)</span>);</p></li>
<li><p>We could also explore uncertainty for the expected value (red line).</p></li>
</ul>
<p><br><br></p>
</div>
<div id="iii.-bayesian-approach" class="section level3 hasAnchor">
<h3>III. Bayesian approach<a href="welcome-to-day-1.html#iii.-bayesian-approach" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>How does it work?</strong></p>
<p>The focus now is not on the most likely value of the parameter, it is on the whole distribution, all values it can assume.</p>
<p>In this approach, we have additional assumptions on the unknown parameters.</p>
<center>
“Bayesian statistical models provide a useful way to obtain inference and predictions for <strong>unobserved quantities</strong> [parameters] in nature based on a solid foundation of mathematical rules pertaining to probability.” (<a href="https://www.taylorfrancis.com/books/mono/10.1201/9780429243653/bringing-bayesian-models-life-trevor-hefley-mevin-hooten">Hooten and Hefley, 2019</a>)
</center>
<p>We use <strong>prior knowledge</strong> about the system, to inform our parameters to be estimated.</p>
<p>Bayesian estimation does not contradict Maximum Likelihood, it extends it!</p>
<center>
<strong>More on day 3</strong>
</center>
<p><img src="_main_files/figure-html/unnamed-chunk-14-1.png" alt="" width="672" /></p>
<p><strong>For our example:</strong></p>
<p>Fit a simple intercept-slope linear model to data using least squares and calculate the value of Ndfa that is needed to achieve a neutral N balance (<span class="math inline">\(\theta\)</span>).</p>
<p><span class="math display">\[ y_i = \beta_0 + \beta_1x_i + \varepsilon_i \\ \varepsilon_i \sim N(0, \sigma^2)\]</span></p>
<p>We will re-write this model, using distributional notation and adding our additional assumptions for other unknown quantities:</p>
<p><span class="math display">\[
\mathbf{y} \sim N(\boldsymbol{\beta_0} + \boldsymbol{\beta_1}\mathbf{x}, \boldsymbol{\sigma}^2) \\ \boldsymbol{\beta_0} \sim N(0, 10^6) \\ \boldsymbol{\beta_1} \sim N(0, 10^6) \\ \boldsymbol{\sigma} \sim Gamma(2.5, 0.05)
\]</span><br />
This notation helps to clearly identify our assumptions!</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="welcome-to-day-1.html#cb10-1" tabindex="-1"></a><span class="fu">library</span>(rjags)</span>
<span id="cb10-2"><a href="welcome-to-day-1.html#cb10-2" tabindex="-1"></a><span class="fu">library</span>(coda)</span>
<span id="cb10-3"><a href="welcome-to-day-1.html#cb10-3" tabindex="-1"></a></span>
<span id="cb10-4"><a href="welcome-to-day-1.html#cb10-4" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>)</span>
<span id="cb10-5"><a href="welcome-to-day-1.html#cb10-5" tabindex="-1"></a></span>
<span id="cb10-6"><a href="welcome-to-day-1.html#cb10-6" tabindex="-1"></a>y <span class="ot">&lt;-</span> df_a<span class="sc">$</span>PartNbalance</span>
<span id="cb10-7"><a href="welcome-to-day-1.html#cb10-7" tabindex="-1"></a>x <span class="ot">&lt;-</span> df_a<span class="sc">$</span>Ndfa</span>
<span id="cb10-8"><a href="welcome-to-day-1.html#cb10-8" tabindex="-1"></a></span>
<span id="cb10-9"><a href="welcome-to-day-1.html#cb10-9" tabindex="-1"></a><span class="co"># JAGS code</span></span>
<span id="cb10-10"><a href="welcome-to-day-1.html#cb10-10" tabindex="-1"></a>data_line <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;y&quot;</span> <span class="ot">=</span> y, <span class="st">&quot;x&quot;</span> <span class="ot">=</span> x, <span class="st">&quot;N&quot;</span> <span class="ot">=</span> <span class="fu">nrow</span>(df_a))</span>
<span id="cb10-11"><a href="welcome-to-day-1.html#cb10-11" tabindex="-1"></a>initials <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb10-12"><a href="welcome-to-day-1.html#cb10-12" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;b0&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">&quot;b1&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">&quot;sigma&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>)</span>
<span id="cb10-13"><a href="welcome-to-day-1.html#cb10-13" tabindex="-1"></a>)</span>
<span id="cb10-14"><a href="welcome-to-day-1.html#cb10-14" tabindex="-1"></a></span>
<span id="cb10-15"><a href="welcome-to-day-1.html#cb10-15" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="st">&quot;model {</span></span>
<span id="cb10-16"><a href="welcome-to-day-1.html#cb10-16" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb10-17"><a href="welcome-to-day-1.html#cb10-17" tabindex="-1"></a><span class="st">    # Likelihood</span></span>
<span id="cb10-18"><a href="welcome-to-day-1.html#cb10-18" tabindex="-1"></a><span class="st">    for(i in 1:N){</span></span>
<span id="cb10-19"><a href="welcome-to-day-1.html#cb10-19" tabindex="-1"></a><span class="st">      y[i] ~ dnorm(mu[i], tau)</span></span>
<span id="cb10-20"><a href="welcome-to-day-1.html#cb10-20" tabindex="-1"></a><span class="st">      mu[i] &lt;- b0 + b1*(x[i])</span></span>
<span id="cb10-21"><a href="welcome-to-day-1.html#cb10-21" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb10-22"><a href="welcome-to-day-1.html#cb10-22" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb10-23"><a href="welcome-to-day-1.html#cb10-23" tabindex="-1"></a><span class="st">    # Priors</span></span>
<span id="cb10-24"><a href="welcome-to-day-1.html#cb10-24" tabindex="-1"></a><span class="st">    b0 ~ dnorm(0, 1/10^6)</span></span>
<span id="cb10-25"><a href="welcome-to-day-1.html#cb10-25" tabindex="-1"></a><span class="st">    b1 ~ dnorm(0, 1/10^6)</span></span>
<span id="cb10-26"><a href="welcome-to-day-1.html#cb10-26" tabindex="-1"></a><span class="st">    sigma ~ dgamma(2.5, 0.05)</span></span>
<span id="cb10-27"><a href="welcome-to-day-1.html#cb10-27" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb10-28"><a href="welcome-to-day-1.html#cb10-28" tabindex="-1"></a><span class="st">    # Derived quantity</span></span>
<span id="cb10-29"><a href="welcome-to-day-1.html#cb10-29" tabindex="-1"></a><span class="st">    theta &lt;- -b0/b1</span></span>
<span id="cb10-30"><a href="welcome-to-day-1.html#cb10-30" tabindex="-1"></a><span class="st">    tau &lt;- 1/(sigma^2)</span></span>
<span id="cb10-31"><a href="welcome-to-day-1.html#cb10-31" tabindex="-1"></a><span class="st">}&quot;</span></span>
<span id="cb10-32"><a href="welcome-to-day-1.html#cb10-32" tabindex="-1"></a></span>
<span id="cb10-33"><a href="welcome-to-day-1.html#cb10-33" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(model_string), <span class="at">inits =</span> initials, <span class="at">data =</span> data_line, <span class="at">n.chains =</span> <span class="dv">1</span>)</span>
<span id="cb10-34"><a href="welcome-to-day-1.html#cb10-34" tabindex="-1"></a></span>
<span id="cb10-35"><a href="welcome-to-day-1.html#cb10-35" tabindex="-1"></a><span class="fu">update</span>(m3, <span class="at">n.iter =</span> <span class="dv">1000</span>)</span>
<span id="cb10-36"><a href="welcome-to-day-1.html#cb10-36" tabindex="-1"></a></span>
<span id="cb10-37"><a href="welcome-to-day-1.html#cb10-37" tabindex="-1"></a>samples <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(m3, <span class="at">variable.names =</span> <span class="fu">c</span>(<span class="st">&quot;b0&quot;</span>, <span class="st">&quot;b1&quot;</span>, <span class="st">&quot;tau&quot;</span>, <span class="st">&quot;theta&quot;</span>, <span class="st">&quot;sigma&quot;</span>), <span class="at">n.iter =</span> <span class="dv">1000</span>)</span>
<span id="cb10-38"><a href="welcome-to-day-1.html#cb10-38" tabindex="-1"></a></span>
<span id="cb10-39"><a href="welcome-to-day-1.html#cb10-39" tabindex="-1"></a><span class="co">#summary(samples)</span></span>
<span id="cb10-40"><a href="welcome-to-day-1.html#cb10-40" tabindex="-1"></a><span class="co">#plot(samples)</span></span>
<span id="cb10-41"><a href="welcome-to-day-1.html#cb10-41" tabindex="-1"></a></span>
<span id="cb10-42"><a href="welcome-to-day-1.html#cb10-42" tabindex="-1"></a><span class="co"># Extract draws and calculate expected line</span></span>
<span id="cb10-43"><a href="welcome-to-day-1.html#cb10-43" tabindex="-1"></a>draws <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(samples)</span>
<span id="cb10-44"><a href="welcome-to-day-1.html#cb10-44" tabindex="-1"></a></span>
<span id="cb10-45"><a href="welcome-to-day-1.html#cb10-45" tabindex="-1"></a>b0_hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;b0&quot;</span>])</span>
<span id="cb10-46"><a href="welcome-to-day-1.html#cb10-46" tabindex="-1"></a>b1_hat <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;b1&quot;</span>])</span>
<span id="cb10-47"><a href="welcome-to-day-1.html#cb10-47" tabindex="-1"></a></span>
<span id="cb10-48"><a href="welcome-to-day-1.html#cb10-48" tabindex="-1"></a>pred_mean <span class="ot">&lt;-</span> b0_hat <span class="sc">+</span> b1_hat<span class="sc">*</span>x</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="welcome-to-day-1.html#cb11-1" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>))</span>
<span id="cb11-2"><a href="welcome-to-day-1.html#cb11-2" tabindex="-1"></a></span>
<span id="cb11-3"><a href="welcome-to-day-1.html#cb11-3" tabindex="-1"></a><span class="fu">hist</span>(draws[, <span class="st">&quot;b0&quot;</span>], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Posterior dist. b0&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;b0&quot;</span>)</span>
<span id="cb11-4"><a href="welcome-to-day-1.html#cb11-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;b0&quot;</span>]), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb11-5"><a href="welcome-to-day-1.html#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="welcome-to-day-1.html#cb11-6" tabindex="-1"></a><span class="fu">hist</span>(draws[, <span class="st">&quot;b1&quot;</span>], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Posterior dist. b1&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;b1&quot;</span>)</span>
<span id="cb11-7"><a href="welcome-to-day-1.html#cb11-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;b1&quot;</span>]), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb11-8"><a href="welcome-to-day-1.html#cb11-8" tabindex="-1"></a></span>
<span id="cb11-9"><a href="welcome-to-day-1.html#cb11-9" tabindex="-1"></a><span class="fu">hist</span>(draws[, <span class="st">&quot;theta&quot;</span>], <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Posterior dist. theta&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;theta&quot;</span>)</span>
<span id="cb11-10"><a href="welcome-to-day-1.html#cb11-10" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;theta&quot;</span>]), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb11-11"><a href="welcome-to-day-1.html#cb11-11" tabindex="-1"></a></span>
<span id="cb11-12"><a href="welcome-to-day-1.html#cb11-12" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">1</span>))</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-16-1.png" alt="" width="672" /></p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="welcome-to-day-1.html#cb12-1" tabindex="-1"></a>theta_CrI <span class="ot">&lt;-</span> <span class="fu">quantile</span>(draws[, <span class="st">&quot;theta&quot;</span>], <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb12-2"><a href="welcome-to-day-1.html#cb12-2" tabindex="-1"></a></span>
<span id="cb12-3"><a href="welcome-to-day-1.html#cb12-3" tabindex="-1"></a><span class="fu">plot</span>(df_a<span class="sc">$</span>Ndfa, df_a<span class="sc">$</span>PartNbalance, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>)</span>
<span id="cb12-4"><a href="welcome-to-day-1.html#cb12-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb12-5"><a href="welcome-to-day-1.html#cb12-5" tabindex="-1"></a><span class="fu">lines</span>(df_a<span class="sc">$</span>Ndfa, pred_mean, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>, <span class="at">lwd =</span> <span class="dv">2</span>)</span>
<span id="cb12-6"><a href="welcome-to-day-1.html#cb12-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> <span class="fu">mean</span>(draws[, <span class="st">&quot;theta&quot;</span>]), <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb12-7"><a href="welcome-to-day-1.html#cb12-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_CrI[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb12-8"><a href="welcome-to-day-1.html#cb12-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_CrI[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" alt="" width="672" /></p>
<p><br><br></p>
<div id="what-changes" class="section level4 hasAnchor">
<h4>What changes?<a href="welcome-to-day-1.html#what-changes" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<table class="table" style="color: black; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;">
Method
</th>
<th style="text-align:center;">
b0
</th>
<th style="text-align:center;">
b1
</th>
<th style="text-align:center;">
theta
</th>
<th style="text-align:center;">
theta_l
</th>
<th style="text-align:center;">
theta_u
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
LS
</td>
<td style="text-align:center;">
-78.38
</td>
<td style="text-align:center;">
1.35
</td>
<td style="text-align:center;">
58.27
</td>
<td style="text-align:center;">
</td>
<td style="text-align:center;">
</td>
</tr>
<tr>
<td style="text-align:center;">
ML
</td>
<td style="text-align:center;">
-78.38
</td>
<td style="text-align:center;">
1.35
</td>
<td style="text-align:center;">
58.27
</td>
<td style="text-align:center;">
52.88
</td>
<td style="text-align:center;">
63.65
</td>
</tr>
<tr>
<td style="text-align:center;">
Bay
</td>
<td style="text-align:center;">
-78.64
</td>
<td style="text-align:center;">
1.35
</td>
<td style="text-align:center;">
58.22
</td>
<td style="text-align:center;">
52.45
</td>
<td style="text-align:center;">
63.65
</td>
</tr>
</tbody>
</table>
<p><strong>Why?</strong></p>
<ul>
<li><p>Simple model</p></li>
<li><p>Lot’s of observations - No deficiency on informational content</p></li>
</ul>
<p><br><br></p>
</div>
<div id="why-bayesian-might-be-useful" class="section level4 hasAnchor">
<h4>Why Bayesian might be useful?<a href="welcome-to-day-1.html#why-bayesian-might-be-useful" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="welcome-to-day-1.html#cb13-1" tabindex="-1"></a>df_b <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span>Scenario <span class="sc">==</span> <span class="st">&quot;Scenario B&quot;</span>),]</span>
<span id="cb13-2"><a href="welcome-to-day-1.html#cb13-2" tabindex="-1"></a><span class="fu">plot</span>(df_b<span class="sc">$</span>Ndfa, df_b<span class="sc">$</span>PartNbalance, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">110</span>))</span>
<span id="cb13-3"><a href="welcome-to-day-1.html#cb13-3" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-19-1.png" alt="" width="672" /></p>
<p>Considerably less observations and balance (<span class="math inline">\(\theta\)</span>) is never observed.</p>
<p>Using Likelihood:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="welcome-to-day-1.html#cb14-1" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb14-2"><a href="welcome-to-day-1.html#cb14-2" tabindex="-1"></a>m4 <span class="ot">&lt;-</span> <span class="fu">gls</span>(PartNbalance <span class="sc">~</span> Ndfa, <span class="at">data =</span> df_b, <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb14-3"><a href="welcome-to-day-1.html#cb14-3" tabindex="-1"></a></span>
<span id="cb14-4"><a href="welcome-to-day-1.html#cb14-4" tabindex="-1"></a><span class="co"># Ndfa to achieve neutral N balance</span></span>
<span id="cb14-5"><a href="welcome-to-day-1.html#cb14-5" tabindex="-1"></a>b0hat_ml2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m4)[<span class="dv">1</span>]) <span class="co"># extract the intercept</span></span>
<span id="cb14-6"><a href="welcome-to-day-1.html#cb14-6" tabindex="-1"></a>b1hat_ml2 <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m4)[<span class="dv">2</span>]) <span class="co"># extract the slope</span></span>
<span id="cb14-7"><a href="welcome-to-day-1.html#cb14-7" tabindex="-1"></a></span>
<span id="cb14-8"><a href="welcome-to-day-1.html#cb14-8" tabindex="-1"></a>thetahat_ml2 <span class="ot">&lt;-</span> <span class="sc">-</span>b0hat_ml2<span class="sc">/</span>b1hat_ml2 <span class="co"># calculate theta</span></span>
<span id="cb14-9"><a href="welcome-to-day-1.html#cb14-9" tabindex="-1"></a></span>
<span id="cb14-10"><a href="welcome-to-day-1.html#cb14-10" tabindex="-1"></a>theta_se2 <span class="ot">&lt;-</span> <span class="fu">deltamethod</span>(<span class="sc">~</span> <span class="sc">-</span>x1<span class="sc">/</span>x2, <span class="at">mean =</span> <span class="fu">coef</span>(m4), <span class="at">cov =</span> <span class="fu">vcov</span>(m4))</span>
<span id="cb14-11"><a href="welcome-to-day-1.html#cb14-11" tabindex="-1"></a>theta_ci2 <span class="ot">&lt;-</span> <span class="fu">c</span>(thetahat_ml2<span class="fl">-1.96</span><span class="sc">*</span>theta_se2, thetahat_ml2<span class="fl">+1.96</span><span class="sc">*</span>theta_se2)</span>
<span id="cb14-12"><a href="welcome-to-day-1.html#cb14-12" tabindex="-1"></a></span>
<span id="cb14-13"><a href="welcome-to-day-1.html#cb14-13" tabindex="-1"></a><span class="fu">plot</span>(df_b<span class="sc">$</span>Ndfa, df_b<span class="sc">$</span>PartNbalance, <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">110</span>), <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N Balance (kg/ha)&quot;</span>)</span>
<span id="cb14-14"><a href="welcome-to-day-1.html#cb14-14" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>)</span>
<span id="cb14-15"><a href="welcome-to-day-1.html#cb14-15" tabindex="-1"></a><span class="fu">abline</span>(m4, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span>
<span id="cb14-16"><a href="welcome-to-day-1.html#cb14-16" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> thetahat_ml2, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb14-17"><a href="welcome-to-day-1.html#cb14-17" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_ci2[<span class="dv">1</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb14-18"><a href="welcome-to-day-1.html#cb14-18" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> theta_ci2[<span class="dv">2</span>], <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-20-1.png" alt="" width="672" /></p>
<p>Using Bayesian:</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="welcome-to-day-1.html#cb15-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>)</span>
<span id="cb15-2"><a href="welcome-to-day-1.html#cb15-2" tabindex="-1"></a></span>
<span id="cb15-3"><a href="welcome-to-day-1.html#cb15-3" tabindex="-1"></a>y <span class="ot">&lt;-</span> df_b<span class="sc">$</span>PartNbalance</span>
<span id="cb15-4"><a href="welcome-to-day-1.html#cb15-4" tabindex="-1"></a>x <span class="ot">&lt;-</span> (df_b<span class="sc">$</span>Ndfa)<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb15-5"><a href="welcome-to-day-1.html#cb15-5" tabindex="-1"></a></span>
<span id="cb15-6"><a href="welcome-to-day-1.html#cb15-6" tabindex="-1"></a><span class="co"># JAGS code</span></span>
<span id="cb15-7"><a href="welcome-to-day-1.html#cb15-7" tabindex="-1"></a>data_line <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">&quot;y&quot;</span> <span class="ot">=</span> y, <span class="st">&quot;x&quot;</span> <span class="ot">=</span> x, <span class="st">&quot;N&quot;</span> <span class="ot">=</span> <span class="fu">nrow</span>(df_b))</span>
<span id="cb15-8"><a href="welcome-to-day-1.html#cb15-8" tabindex="-1"></a>initials <span class="ot">&lt;-</span> <span class="fu">list</span>(</span>
<span id="cb15-9"><a href="welcome-to-day-1.html#cb15-9" tabindex="-1"></a>  <span class="fu">list</span>(<span class="st">&quot;theta&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">&quot;b1&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>, <span class="st">&quot;sigma&quot;</span> <span class="ot">=</span> <span class="fl">0.1</span>)</span>
<span id="cb15-10"><a href="welcome-to-day-1.html#cb15-10" tabindex="-1"></a>)</span>
<span id="cb15-11"><a href="welcome-to-day-1.html#cb15-11" tabindex="-1"></a></span>
<span id="cb15-12"><a href="welcome-to-day-1.html#cb15-12" tabindex="-1"></a>model_string <span class="ot">&lt;-</span> <span class="st">&quot;model {</span></span>
<span id="cb15-13"><a href="welcome-to-day-1.html#cb15-13" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb15-14"><a href="welcome-to-day-1.html#cb15-14" tabindex="-1"></a><span class="st">    # Likelihood</span></span>
<span id="cb15-15"><a href="welcome-to-day-1.html#cb15-15" tabindex="-1"></a><span class="st">    for(i in 1:N){</span></span>
<span id="cb15-16"><a href="welcome-to-day-1.html#cb15-16" tabindex="-1"></a><span class="st">      y[i] ~ dnorm(mu[i], tau)</span></span>
<span id="cb15-17"><a href="welcome-to-day-1.html#cb15-17" tabindex="-1"></a><span class="st">      mu[i] &lt;- -b1*theta + b1*(x[i])</span></span>
<span id="cb15-18"><a href="welcome-to-day-1.html#cb15-18" tabindex="-1"></a><span class="st">}</span></span>
<span id="cb15-19"><a href="welcome-to-day-1.html#cb15-19" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb15-20"><a href="welcome-to-day-1.html#cb15-20" tabindex="-1"></a><span class="st">    # Priors</span></span>
<span id="cb15-21"><a href="welcome-to-day-1.html#cb15-21" tabindex="-1"></a><span class="st">    b1 ~ dgamma(1.6, 0.8)</span></span>
<span id="cb15-22"><a href="welcome-to-day-1.html#cb15-22" tabindex="-1"></a><span class="st">    theta ~ dbeta(62.52, 14.06)</span></span>
<span id="cb15-23"><a href="welcome-to-day-1.html#cb15-23" tabindex="-1"></a><span class="st">    sigma ~ dgamma(2.5, 0.05)</span></span>
<span id="cb15-24"><a href="welcome-to-day-1.html#cb15-24" tabindex="-1"></a><span class="st">    </span></span>
<span id="cb15-25"><a href="welcome-to-day-1.html#cb15-25" tabindex="-1"></a><span class="st">    # Derived quantity</span></span>
<span id="cb15-26"><a href="welcome-to-day-1.html#cb15-26" tabindex="-1"></a><span class="st">    b0 &lt;- -b1*theta</span></span>
<span id="cb15-27"><a href="welcome-to-day-1.html#cb15-27" tabindex="-1"></a><span class="st">    tau &lt;- 1/(sigma^2)</span></span>
<span id="cb15-28"><a href="welcome-to-day-1.html#cb15-28" tabindex="-1"></a><span class="st">}&quot;</span></span>
<span id="cb15-29"><a href="welcome-to-day-1.html#cb15-29" tabindex="-1"></a></span>
<span id="cb15-30"><a href="welcome-to-day-1.html#cb15-30" tabindex="-1"></a>m5 <span class="ot">&lt;-</span> <span class="fu">jags.model</span>(<span class="fu">textConnection</span>(model_string), <span class="at">inits =</span> initials, <span class="at">data =</span> data_line, <span class="at">n.chains =</span> <span class="dv">1</span>)</span>
<span id="cb15-31"><a href="welcome-to-day-1.html#cb15-31" tabindex="-1"></a></span>
<span id="cb15-32"><a href="welcome-to-day-1.html#cb15-32" tabindex="-1"></a><span class="fu">update</span>(m5, <span class="at">n.iter =</span> <span class="dv">1000</span>)</span>
<span id="cb15-33"><a href="welcome-to-day-1.html#cb15-33" tabindex="-1"></a></span>
<span id="cb15-34"><a href="welcome-to-day-1.html#cb15-34" tabindex="-1"></a>samples2 <span class="ot">&lt;-</span> <span class="fu">coda.samples</span>(m5, <span class="at">variable.names =</span> <span class="fu">c</span>(<span class="st">&quot;b0&quot;</span>, <span class="st">&quot;b1&quot;</span>, <span class="st">&quot;tau&quot;</span>, <span class="st">&quot;theta&quot;</span>, <span class="st">&quot;sigma&quot;</span>), <span class="at">n.iter =</span> <span class="dv">1000</span>)</span>
<span id="cb15-35"><a href="welcome-to-day-1.html#cb15-35" tabindex="-1"></a></span>
<span id="cb15-36"><a href="welcome-to-day-1.html#cb15-36" tabindex="-1"></a><span class="co">#summary(samples2)</span></span>
<span id="cb15-37"><a href="welcome-to-day-1.html#cb15-37" tabindex="-1"></a><span class="co">#plot(samples2)</span></span>
<span id="cb15-38"><a href="welcome-to-day-1.html#cb15-38" tabindex="-1"></a></span>
<span id="cb15-39"><a href="welcome-to-day-1.html#cb15-39" tabindex="-1"></a><span class="co"># Extract draws and calculate expected line</span></span>
<span id="cb15-40"><a href="welcome-to-day-1.html#cb15-40" tabindex="-1"></a>draws2 <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(samples2)</span>
<span id="cb15-41"><a href="welcome-to-day-1.html#cb15-41" tabindex="-1"></a></span>
<span id="cb15-42"><a href="welcome-to-day-1.html#cb15-42" tabindex="-1"></a>theta_hat2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws2[, <span class="st">&quot;theta&quot;</span>])</span>
<span id="cb15-43"><a href="welcome-to-day-1.html#cb15-43" tabindex="-1"></a>b1_hat2 <span class="ot">&lt;-</span> <span class="fu">mean</span>(draws2[, <span class="st">&quot;b1&quot;</span>])</span>
<span id="cb15-44"><a href="welcome-to-day-1.html#cb15-44" tabindex="-1"></a></span>
<span id="cb15-45"><a href="welcome-to-day-1.html#cb15-45" tabindex="-1"></a>pred_mean2 <span class="ot">&lt;-</span> b1_hat2<span class="sc">*</span> <span class="sc">+</span> b1_hat2<span class="sc">*</span>x</span></code></pre></div>
</details>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="welcome-to-day-1.html#cb16-1" tabindex="-1"></a>theta_CrI2 <span class="ot">&lt;-</span> <span class="fu">quantile</span>(draws2[, <span class="st">&quot;theta&quot;</span>], <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span>
<span id="cb16-2"><a href="welcome-to-day-1.html#cb16-2" tabindex="-1"></a></span>
<span id="cb16-3"><a href="welcome-to-day-1.html#cb16-3" tabindex="-1"></a><span class="fu">plot</span>(df_b<span class="sc">$</span>Ndfa, df_b<span class="sc">$</span>PartNbalance, <span class="at">xlab =</span> <span class="st">&quot;Ndfa (%)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Partial N balance (kg/ha)&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">100</span>, <span class="dv">100</span>), <span class="at">xlim =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">110</span>))</span>
<span id="cb16-4"><a href="welcome-to-day-1.html#cb16-4" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">a =</span> <span class="dv">0</span>, <span class="at">b =</span> <span class="dv">0</span>, <span class="at">col =</span> <span class="st">&quot;gold&quot;</span>, <span class="at">lwd =</span> <span class="dv">3</span>)</span>
<span id="cb16-5"><a href="welcome-to-day-1.html#cb16-5" tabindex="-1"></a><span class="co">#lines(df_b$Ndfa, pred_mean2, col = &quot;red&quot;, lwd = 2)</span></span>
<span id="cb16-6"><a href="welcome-to-day-1.html#cb16-6" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> (<span class="fu">mean</span>(draws2[, <span class="st">&quot;theta&quot;</span>]))<span class="sc">*</span><span class="dv">100</span>, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb16-7"><a href="welcome-to-day-1.html#cb16-7" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> (theta_CrI2[<span class="dv">1</span>])<span class="sc">*</span><span class="dv">100</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span>
<span id="cb16-8"><a href="welcome-to-day-1.html#cb16-8" tabindex="-1"></a><span class="fu">abline</span>(<span class="at">v =</span> (theta_CrI2[<span class="dv">2</span>])<span class="sc">*</span><span class="dv">100</span>, <span class="at">lwd =</span> <span class="dv">1</span>, <span class="at">lty =</span> <span class="dv">2</span>, <span class="at">col =</span> <span class="st">&quot;green&quot;</span>)</span></code></pre></div>
</details>
<p><img src="_main_files/figure-html/unnamed-chunk-22-1.png" alt="" width="672" /></p>
<p>Why?</p>
<ul>
<li><p>Deficient information about <span class="math inline">\(\theta\)</span> in this dataset.</p></li>
<li><p>Bayesian offers the opportunity to utilize prior information to constraint <span class="math inline">\(\hat{\theta}\)</span>.</p></li>
<li><p>We treat <span class="math inline">\(\theta\)</span> as a <strong>random variable.</strong></p></li>
</ul>
<div class="important">
<p><strong>Highlight from Section 2:</strong></p>
<center>
<p>There are different approaches to estimate the model parameters, some, rely more heavily on data (Loss function and Likelihood), and some less (Bayesian).</p>
<p>Estimation can interfere with inference when few observations are available or low information regarding a specific parameter.</p>
<p>Loss function approaches do not allow inference. Inference comes with a price, assumptions!</p>
<p>More assumptions, more difficult to work with the model. Choose your battles, it is not always worth to go this route!</p>
</center>
</div>
<p><br><br></p>
</div>
</div>
<div id="questions" class="section level3 hasAnchor">
<h3>Questions<a href="welcome-to-day-1.html#questions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<ul>
<li>Sample code is provided for some questions. Code used on the class examples can also be used to work on this practice.</li>
</ul>
<div id="recommended---based-for-day-2" class="section level4 hasAnchor">
<h4>Recommended - Based for Day 2<a href="welcome-to-day-1.html#recommended---based-for-day-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>On Days 2 and 3 we will work with an example of logistic growth curve. Growth curves are widely used in biology to study population dynamics. A good reading: <a href="https://www.sciencedirect.com/science/article/pii/S0025556402000962">Analysis of logistic growth models - Tsoularis and Wallace (2002)</a>.</p>
<p>Here we will apply it to plant disease growth on time. We will use this model:</p>
<p><span class="math display">\[
y_i = \frac{K}{1 + (\frac{K - y_0}{y_0})e^{-rt_i}} + \varepsilon_i
\]</span></p>
<p>In which the parameters have meaning:</p>
<ul>
<li><p><span class="math inline">\(K\)</span> - Maximum disease potential - Maximum severity level</p></li>
<li><p><span class="math inline">\(r\)</span> - Disease rate of growth - How fast it grows</p></li>
<li><p><span class="math inline">\(y_0\)</span> - Initial disease level</p></li>
</ul>
<p>The disease data is in the file “nonlin.csv”. In this data, <span class="math inline">\(y_i\)</span> represent disease severity (column: severity, % of leaf area affected by the disease). Our goal is to model severity by time (column = time, days).</p>
<p>What else is in this data?</p>
<ul>
<li><p>Year (column: year) - Two different seasons, 2023 with less disease and 2024 with more</p></li>
<li><p>Variety (column: var) - A moderately resistant variety (b) and a susceptible one (a)</p></li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="welcome-to-day-1.html#cb17-1" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb17-2"><a href="welcome-to-day-1.html#cb17-2" tabindex="-1"></a>nl_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">&quot;nonlin.csv&quot;</span>)</span>
<span id="cb17-3"><a href="welcome-to-day-1.html#cb17-3" tabindex="-1"></a>nl_24 <span class="ot">&lt;-</span> nl_df[<span class="fu">which</span>(nl_df<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2024</span> <span class="sc">&amp;</span> nl_df<span class="sc">$</span>var <span class="sc">==</span> <span class="st">&quot;a&quot;</span>),]</span>
<span id="cb17-4"><a href="welcome-to-day-1.html#cb17-4" tabindex="-1"></a>nl_24<span class="sc">$</span>p_sev <span class="ot">&lt;-</span> nl_24<span class="sc">$</span>severity<span class="sc">/</span><span class="dv">100</span></span>
<span id="cb17-5"><a href="welcome-to-day-1.html#cb17-5" tabindex="-1"></a>nl_23 <span class="ot">&lt;-</span> nl_df[<span class="fu">which</span>(nl_df<span class="sc">$</span>year <span class="sc">==</span> <span class="dv">2023</span> <span class="sc">&amp;</span> nl_df<span class="sc">$</span>var <span class="sc">==</span> <span class="st">&quot;a&quot;</span>),]</span>
<span id="cb17-6"><a href="welcome-to-day-1.html#cb17-6" tabindex="-1"></a>nl_23<span class="sc">$</span>p_sev <span class="ot">&lt;-</span> nl_23<span class="sc">$</span>severity<span class="sc">/</span><span class="dv">100</span></span></code></pre></div>
</details>
<p>Recall that to work with non-linear models, we either linearize it or fit as it is.</p>
<p>First, use linearization to fit a linear model for 2024. We will use a logit transformation:</p>
<p><span class="math display">\[ logit(y_i) = \beta_0 + \beta_1*x_i + \varepsilon_i \]</span></p>
<p>Where <span class="math inline">\(\beta_1 \sim r\)</span> from the nonlinear form.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="welcome-to-day-1.html#cb18-1" tabindex="-1"></a><span class="co"># Example for 2024</span></span>
<span id="cb18-2"><a href="welcome-to-day-1.html#cb18-2" tabindex="-1"></a></span>
<span id="cb18-3"><a href="welcome-to-day-1.html#cb18-3" tabindex="-1"></a><span class="co"># For this, we assume K = 1</span></span>
<span id="cb18-4"><a href="welcome-to-day-1.html#cb18-4" tabindex="-1"></a>nl_24<span class="sc">$</span>p_sev <span class="ot">&lt;-</span> nl_24<span class="sc">$</span>p_sev <span class="sc">+</span> <span class="fl">0.001</span> <span class="co"># Correction for log</span></span>
<span id="cb18-5"><a href="welcome-to-day-1.html#cb18-5" tabindex="-1"></a>nl_24<span class="sc">$</span>l_sev <span class="ot">&lt;-</span> <span class="fu">log</span>(nl_24<span class="sc">$</span>p_sev<span class="sc">/</span>(<span class="dv">1</span><span class="sc">-</span>nl_24<span class="sc">$</span>p_sev))</span>
<span id="cb18-6"><a href="welcome-to-day-1.html#cb18-6" tabindex="-1"></a></span>
<span id="cb18-7"><a href="welcome-to-day-1.html#cb18-7" tabindex="-1"></a><span class="co"># Fit the linear model to the logit transformed y</span></span>
<span id="cb18-8"><a href="welcome-to-day-1.html#cb18-8" tabindex="-1"></a>m1 <span class="ot">&lt;-</span> <span class="fu">lm</span>(l_sev <span class="sc">~</span> time, <span class="at">data =</span> nl_24)</span>
<span id="cb18-9"><a href="welcome-to-day-1.html#cb18-9" tabindex="-1"></a></span>
<span id="cb18-10"><a href="welcome-to-day-1.html#cb18-10" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb18-11"><a href="welcome-to-day-1.html#cb18-11" tabindex="-1"></a>logit_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb18-12"><a href="welcome-to-day-1.html#cb18-12" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(nl_24<span class="sc">$</span>time), <span class="fu">max</span>(nl_24<span class="sc">$</span>time), <span class="dv">1</span>))</span>
<span id="cb18-13"><a href="welcome-to-day-1.html#cb18-13" tabindex="-1"></a></span>
<span id="cb18-14"><a href="welcome-to-day-1.html#cb18-14" tabindex="-1"></a>logit_pred<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m1, <span class="at">newdata =</span> logit_pred)</span>
<span id="cb18-15"><a href="welcome-to-day-1.html#cb18-15" tabindex="-1"></a></span>
<span id="cb18-16"><a href="welcome-to-day-1.html#cb18-16" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb18-17"><a href="welcome-to-day-1.html#cb18-17" tabindex="-1"></a><span class="fu">plot</span>(nl_24<span class="sc">$</span>time, nl_24<span class="sc">$</span>l_sev, <span class="at">ylab =</span> <span class="st">&quot;Logit(y)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Days&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="dv">7</span>, <span class="dv">5</span>))</span>
<span id="cb18-18"><a href="welcome-to-day-1.html#cb18-18" tabindex="-1"></a><span class="fu">lines</span>(logit_pred<span class="sc">$</span>time, logit_pred<span class="sc">$</span>pred, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
</details>
<p>Now, fit the non-linear model for 2024 and 2023. Plot data and predictions. Save models for the next question.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="welcome-to-day-1.html#cb19-1" tabindex="-1"></a><span class="co"># Example for 2024</span></span>
<span id="cb19-2"><a href="welcome-to-day-1.html#cb19-2" tabindex="-1"></a></span>
<span id="cb19-3"><a href="welcome-to-day-1.html#cb19-3" tabindex="-1"></a><span class="co"># Fit the logistic model</span></span>
<span id="cb19-4"><a href="welcome-to-day-1.html#cb19-4" tabindex="-1"></a>m2 <span class="ot">&lt;-</span> <span class="fu">nls</span>(p_sev <span class="sc">~</span> K<span class="sc">/</span>(<span class="dv">1</span> <span class="sc">+</span> ((K<span class="sc">-</span>y0)<span class="sc">/</span>y0)<span class="sc">*</span><span class="fu">exp</span>(<span class="sc">-</span>r<span class="sc">*</span>time)), <span class="at">data =</span> nl_24, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">K =</span> <span class="fl">0.7</span>, <span class="at">y0 =</span> <span class="fl">0.001</span>, <span class="at">r =</span> <span class="fl">0.2</span>))</span>
<span id="cb19-5"><a href="welcome-to-day-1.html#cb19-5" tabindex="-1"></a></span>
<span id="cb19-6"><a href="welcome-to-day-1.html#cb19-6" tabindex="-1"></a><span class="co"># Predict using the logistic curve</span></span>
<span id="cb19-7"><a href="welcome-to-day-1.html#cb19-7" tabindex="-1"></a>nl_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb19-8"><a href="welcome-to-day-1.html#cb19-8" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(nl_24<span class="sc">$</span>time), <span class="fu">max</span>(nl_24<span class="sc">$</span>time), <span class="dv">1</span>))</span>
<span id="cb19-9"><a href="welcome-to-day-1.html#cb19-9" tabindex="-1"></a></span>
<span id="cb19-10"><a href="welcome-to-day-1.html#cb19-10" tabindex="-1"></a>nl_pred<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m2, <span class="at">newdata =</span> nl_pred)</span>
<span id="cb19-11"><a href="welcome-to-day-1.html#cb19-11" tabindex="-1"></a></span>
<span id="cb19-12"><a href="welcome-to-day-1.html#cb19-12" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb19-13"><a href="welcome-to-day-1.html#cb19-13" tabindex="-1"></a><span class="fu">plot</span>(nl_24<span class="sc">$</span>time, nl_24<span class="sc">$</span>p_sev, <span class="at">ylab =</span> <span class="st">&quot;Severity (prop.)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Days&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">1</span>))</span>
<span id="cb19-14"><a href="welcome-to-day-1.html#cb19-14" tabindex="-1"></a><span class="fu">lines</span>(nl_pred<span class="sc">$</span>time, nl_pred<span class="sc">$</span>pred, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
</details>
<p>Extract model parameters. Check the Wald Confidence Intervals. Do you think these values make sense?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="welcome-to-day-1.html#cb20-1" tabindex="-1"></a><span class="fu">summary</span>(m2) <span class="co"># Overall model summary</span></span>
<span id="cb20-2"><a href="welcome-to-day-1.html#cb20-2" tabindex="-1"></a></span>
<span id="cb20-3"><a href="welcome-to-day-1.html#cb20-3" tabindex="-1"></a><span class="co"># Example - For K:</span></span>
<span id="cb20-4"><a href="welcome-to-day-1.html#cb20-4" tabindex="-1"></a><span class="do">## Extract the estimated value</span></span>
<span id="cb20-5"><a href="welcome-to-day-1.html#cb20-5" tabindex="-1"></a>K <span class="ot">&lt;-</span> <span class="fu">as.numeric</span>(<span class="fu">coef</span>(m2)[<span class="dv">1</span>])</span>
<span id="cb20-6"><a href="welcome-to-day-1.html#cb20-6" tabindex="-1"></a></span>
<span id="cb20-7"><a href="welcome-to-day-1.html#cb20-7" tabindex="-1"></a><span class="do">## Calculate Wald Confidence Interval for the parameter estimate</span></span>
<span id="cb20-8"><a href="welcome-to-day-1.html#cb20-8" tabindex="-1"></a>K_sd <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">vcov</span>(m2)[<span class="dv">1</span>])</span>
<span id="cb20-9"><a href="welcome-to-day-1.html#cb20-9" tabindex="-1"></a>K_lb <span class="ot">&lt;-</span> K<span class="fl">-1.96</span><span class="sc">*</span>K_sd <span class="co"># CI Lower</span></span>
<span id="cb20-10"><a href="welcome-to-day-1.html#cb20-10" tabindex="-1"></a>K_ub <span class="ot">&lt;-</span> K<span class="fl">+1.96</span><span class="sc">*</span>K_sd <span class="co"># CI Upper</span></span>
<span id="cb20-11"><a href="welcome-to-day-1.html#cb20-11" tabindex="-1"></a></span>
<span id="cb20-12"><a href="welcome-to-day-1.html#cb20-12" tabindex="-1"></a><span class="co"># Notes for you:</span></span>
<span id="cb20-13"><a href="welcome-to-day-1.html#cb20-13" tabindex="-1"></a><span class="do">## nls in R uses least squares, a loss function approach. Recall: Minimize the loss function. </span></span>
<span id="cb20-14"><a href="welcome-to-day-1.html#cb20-14" tabindex="-1"></a></span>
<span id="cb20-15"><a href="welcome-to-day-1.html#cb20-15" tabindex="-1"></a><span class="do">## To get CI here we are making additional assumptions that we do not make for loss function approach: iid normal residuals.</span></span>
<span id="cb20-16"><a href="welcome-to-day-1.html#cb20-16" tabindex="-1"></a></span>
<span id="cb20-17"><a href="welcome-to-day-1.html#cb20-17" tabindex="-1"></a><span class="do">## This is possible because LS = ML under iid Normal errors with constant variance.</span></span>
<span id="cb20-18"><a href="welcome-to-day-1.html#cb20-18" tabindex="-1"></a></span>
<span id="cb20-19"><a href="welcome-to-day-1.html#cb20-19" tabindex="-1"></a><span class="do">## Why 1.96? It represents the 97.5th percentile of the std N distribution.</span></span></code></pre></div>
</details>
<p>Try fitting a polynomial to this data. Does the predicted curve make sense visually?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="welcome-to-day-1.html#cb21-1" tabindex="-1"></a><span class="co"># Example for 2024</span></span>
<span id="cb21-2"><a href="welcome-to-day-1.html#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="welcome-to-day-1.html#cb21-3" tabindex="-1"></a><span class="co"># Fit the model</span></span>
<span id="cb21-4"><a href="welcome-to-day-1.html#cb21-4" tabindex="-1"></a>m3 <span class="ot">&lt;-</span> <span class="fu">lm</span>(p_sev <span class="sc">~</span> <span class="fu">poly</span>(time, <span class="at">degree =</span> <span class="dv">3</span>), <span class="at">data =</span> nl_24)</span>
<span id="cb21-5"><a href="welcome-to-day-1.html#cb21-5" tabindex="-1"></a></span>
<span id="cb21-6"><a href="welcome-to-day-1.html#cb21-6" tabindex="-1"></a><span class="co"># Make predictions</span></span>
<span id="cb21-7"><a href="welcome-to-day-1.html#cb21-7" tabindex="-1"></a>poly_pred <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb21-8"><a href="welcome-to-day-1.html#cb21-8" tabindex="-1"></a>  <span class="at">time =</span> <span class="fu">seq</span>(<span class="fu">min</span>(nl_24<span class="sc">$</span>time), <span class="fu">max</span>(nl_24<span class="sc">$</span>time), <span class="dv">1</span>))</span>
<span id="cb21-9"><a href="welcome-to-day-1.html#cb21-9" tabindex="-1"></a></span>
<span id="cb21-10"><a href="welcome-to-day-1.html#cb21-10" tabindex="-1"></a>poly_pred<span class="sc">$</span>pred <span class="ot">&lt;-</span> <span class="fu">predict</span>(m3, <span class="at">newdata =</span> poly_pred)</span>
<span id="cb21-11"><a href="welcome-to-day-1.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="welcome-to-day-1.html#cb21-12" tabindex="-1"></a><span class="co"># Plot predictions</span></span>
<span id="cb21-13"><a href="welcome-to-day-1.html#cb21-13" tabindex="-1"></a><span class="fu">plot</span>(nl_24<span class="sc">$</span>time, nl_24<span class="sc">$</span>p_sev, <span class="at">ylab =</span> <span class="st">&quot;Severity (prop.)&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;Days&quot;</span>, <span class="at">ylim =</span> <span class="fu">c</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="dv">1</span>))</span>
<span id="cb21-14"><a href="welcome-to-day-1.html#cb21-14" tabindex="-1"></a><span class="fu">lines</span>(poly_pred<span class="sc">$</span>time, poly_pred<span class="sc">$</span>pred, <span class="at">lwd =</span> <span class="dv">3</span>, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
</details>
<p>Are the parameters still carrying biological meaning? How fast is the disease growing?</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="welcome-to-day-1.html#cb22-1" tabindex="-1"></a><span class="fu">summary</span>(m3)</span></code></pre></div>
</details>
<p><br><br></p>
</div>
<div id="optional---for-practice-only" class="section level4 hasAnchor">
<h4>Optional - For practice only!<a href="welcome-to-day-1.html#optional---for-practice-only" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Using the field pea and white lupine data, experiment fitting the simple intercept-slope linear model (<span class="math inline">\(y_i = \beta_0 + \beta_1*xi + \varepsilon_i\)</span>) using the likelihood approach.</p>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="welcome-to-day-1.html#cb23-1" tabindex="-1"></a><span class="co"># Data</span></span>
<span id="cb23-2"><a href="welcome-to-day-1.html#cb23-2" tabindex="-1"></a><span class="do">## Field pea data (Scenario A)</span></span>
<span id="cb23-3"><a href="welcome-to-day-1.html#cb23-3" tabindex="-1"></a>fp <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span>Scenario <span class="sc">==</span> <span class="st">&quot;Scenario A&quot;</span>),]</span>
<span id="cb23-4"><a href="welcome-to-day-1.html#cb23-4" tabindex="-1"></a></span>
<span id="cb23-5"><a href="welcome-to-day-1.html#cb23-5" tabindex="-1"></a><span class="do">## White lupine data (Scenario B)</span></span>
<span id="cb23-6"><a href="welcome-to-day-1.html#cb23-6" tabindex="-1"></a>wl <span class="ot">&lt;-</span> df[<span class="fu">which</span>(df<span class="sc">$</span>Scenario <span class="sc">==</span> <span class="st">&quot;Scenario B&quot;</span>),]</span></code></pre></div>
</details>
<p>Calculate the derived quantity <span class="math inline">\(\hat{\theta}\)</span>, and use delta method and bootstrap to obtain confidence intervals. Compare the intervals between the two datasets.</p>
<ul>
<li>Bootstrap is another option to get predictive intervals, instead of using the delta method.</li>
</ul>
<details class=chunk-details><summary class=chunk-summary><span class=chunk-summary-text>Code</span></summary>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="welcome-to-day-1.html#cb24-1" tabindex="-1"></a><span class="co"># Bootstrap for field pea (fp)</span></span>
<span id="cb24-2"><a href="welcome-to-day-1.html#cb24-2" tabindex="-1"></a></span>
<span id="cb24-3"><a href="welcome-to-day-1.html#cb24-3" tabindex="-1"></a><span class="fu">library</span>(nlme) <span class="co"># gls function for model fit</span></span>
<span id="cb24-4"><a href="welcome-to-day-1.html#cb24-4" tabindex="-1"></a></span>
<span id="cb24-5"><a href="welcome-to-day-1.html#cb24-5" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2026</span>) <span class="co"># As we are working with a random (stochastic) process, we need to set seed to be able to reproduce the results</span></span>
<span id="cb24-6"><a href="welcome-to-day-1.html#cb24-6" tabindex="-1"></a></span>
<span id="cb24-7"><a href="welcome-to-day-1.html#cb24-7" tabindex="-1"></a>ite <span class="ot">&lt;-</span> <span class="dv">1000</span> <span class="co"># How many iterations (repetitions of the process) we will have</span></span>
<span id="cb24-8"><a href="welcome-to-day-1.html#cb24-8" tabindex="-1"></a></span>
<span id="cb24-9"><a href="welcome-to-day-1.html#cb24-9" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="fu">nrow</span>(fp) <span class="co"># Sample size to be collected (= df size)</span></span>
<span id="cb24-10"><a href="welcome-to-day-1.html#cb24-10" tabindex="-1"></a></span>
<span id="cb24-11"><a href="welcome-to-day-1.html#cb24-11" tabindex="-1"></a>theta.save <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">0</span>, ite<span class="dv">-1</span>) <span class="co"># Save theta calculated for each sample</span></span>
<span id="cb24-12"><a href="welcome-to-day-1.html#cb24-12" tabindex="-1"></a></span>
<span id="cb24-13"><a href="welcome-to-day-1.html#cb24-13" tabindex="-1"></a><span class="co"># Custom bootstrap algorithm</span></span>
<span id="cb24-14"><a href="welcome-to-day-1.html#cb24-14" tabindex="-1"></a><span class="cf">for</span>(i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>ite){</span>
<span id="cb24-15"><a href="welcome-to-day-1.html#cb24-15" tabindex="-1"></a>  </span>
<span id="cb24-16"><a href="welcome-to-day-1.html#cb24-16" tabindex="-1"></a>  sample <span class="ot">&lt;-</span> fp[<span class="fu">sample</span>(<span class="fu">nrow</span>(fp), n, <span class="at">replace =</span> <span class="cn">TRUE</span>), ]</span>
<span id="cb24-17"><a href="welcome-to-day-1.html#cb24-17" tabindex="-1"></a>  </span>
<span id="cb24-18"><a href="welcome-to-day-1.html#cb24-18" tabindex="-1"></a>  fit <span class="ot">&lt;-</span> <span class="fu">gls</span>(PartNbalance <span class="sc">~</span> Ndfa, <span class="at">data =</span> sample, <span class="at">method =</span> <span class="st">&quot;ML&quot;</span>)</span>
<span id="cb24-19"><a href="welcome-to-day-1.html#cb24-19" tabindex="-1"></a>  </span>
<span id="cb24-20"><a href="welcome-to-day-1.html#cb24-20" tabindex="-1"></a>  theta <span class="ot">&lt;-</span> <span class="sc">-</span><span class="fu">coef</span>(fit)[<span class="dv">1</span>]<span class="sc">/</span><span class="fu">coef</span>(fit)[<span class="dv">2</span>]</span>
<span id="cb24-21"><a href="welcome-to-day-1.html#cb24-21" tabindex="-1"></a>  </span>
<span id="cb24-22"><a href="welcome-to-day-1.html#cb24-22" tabindex="-1"></a>  theta.save[i] <span class="ot">&lt;-</span> theta</span>
<span id="cb24-23"><a href="welcome-to-day-1.html#cb24-23" tabindex="-1"></a>  </span>
<span id="cb24-24"><a href="welcome-to-day-1.html#cb24-24" tabindex="-1"></a>}</span>
<span id="cb24-25"><a href="welcome-to-day-1.html#cb24-25" tabindex="-1"></a></span>
<span id="cb24-26"><a href="welcome-to-day-1.html#cb24-26" tabindex="-1"></a><span class="co"># Plot the bootstrap distribution</span></span>
<span id="cb24-27"><a href="welcome-to-day-1.html#cb24-27" tabindex="-1"></a><span class="fu">hist</span>(theta.save, <span class="at">freq =</span> <span class="cn">FALSE</span>, <span class="at">main =</span> <span class="st">&quot;Bootstrap distribution of theta&quot;</span>, <span class="at">xlab =</span> <span class="st">&quot;theta&quot;</span>)</span>
<span id="cb24-28"><a href="welcome-to-day-1.html#cb24-28" tabindex="-1"></a></span>
<span id="cb24-29"><a href="welcome-to-day-1.html#cb24-29" tabindex="-1"></a><span class="co"># 95% CI</span></span>
<span id="cb24-30"><a href="welcome-to-day-1.html#cb24-30" tabindex="-1"></a><span class="fu">quantile</span>(theta.save, <span class="at">probs =</span> <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))</span></code></pre></div>
</details>
<p>Steps:</p>
<ul>
<li><p>Sample n elements with replacement from the original data</p></li>
<li><p>For every sample calculate the desired statistic (here <span class="math inline">\(\theta\)</span>)</p></li>
<li><p>Repeat steps 1 and 2 n times (iterations = ite) and save the calculated statistic</p></li>
<li><p>Plot the calculated statistics which forms the bootstrap distribution</p></li>
<li><p>Using the bootstrap distribution of desired statistics calculate the 95% CI</p></li>
</ul>

</div>
</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="1">
<li id="fn1"><p>We are using scalar notation throughout this class.<a href="welcome-to-day-1.html#fnref1" class="footnote-back">↩︎</a></p></li>
<li id="fn2"><p>Base function is a known function of the predictor (<span class="math inline">\(x\)</span>) that gets its own coefficient in a linear model. In short, a mathematical transformation of the predictor. For example, the linear model <span class="math inline">\(y_i = \beta_0 + \beta_1x_i + \varepsilon_i\)</span> can be written as <span class="math inline">\(y_i = \beta_0 * 1 + \beta_1 * x + \varepsilon_i\)</span>, in which the base functions (<span class="math inline">\(b\)</span>) are <span class="math inline">\(b_0(x) = 1\)</span> and <span class="math inline">\(b_1(x) = x\)</span>. For polynomial regression, for example, the base function could be represented as <span class="math inline">\(b_d(x_i) = x_i^d\)</span>, with <span class="math inline">\(d\)</span> being the polynomial degree.<a href="welcome-to-day-1.html#fnref2" class="footnote-back">↩︎</a></p></li>
<li id="fn3"><p>Derived quantities are functions of model parameters<a href="welcome-to-day-1.html#fnref3" class="footnote-back">↩︎</a></p></li>
<li id="fn4"><p>The Delta Method approximates the uncertainty of a transformed estimator (derived quantity), assuming it was originally approximately normal.<a href="welcome-to-day-1.html#fnref4" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="pre-workshop-guide.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="welcome-to-day-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
  "sharing": {
    "github": false,
    "facebook": true,
    "twitter": true,
    "linkedin": false,
    "weibo": false,
    "instapaper": false,
    "vk": false,
    "whatsapp": false,
    "all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
  },
  "fontsettings": {
    "theme": "white",
    "family": "sans",
    "size": 2
  },
  "edit": {
    "link": null,
    "text": null
  },
  "history": {
    "link": null,
    "text": null
  },
  "view": {
    "link": null,
    "text": null
  },
  "download": ["_main.pdf", "_main.epub"],
  "search": {
    "engine": "fuse",
    "options": null
  },
  "toc": {
    "collapse": "subsection",
    "chapter_name": ""
  }
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
